<% content_for :title, @taxonomy.name %>

<p class="space"></p>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-0">
      Taxonomy <%= @taxonomy.name %>
      <% if @taxonomy.fixed? %>
        <span class="badge bg-warning text-dark ms-2 bg-sm">Fixed</span>
      <% end %>
    </h4>
  </div>
  <div class="btn-group" role="group">
    <%= link_to edit_story_taxonomy_path(@story, @taxonomy), class: "btn btn-outline-secondary" do %>
      <i class="bi bi-pencil"></i> Edit Taxonomy
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-header bg-info">
    <h5 class="card-title mb-0">Taxonomy Details</h5>
  </div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-4">Name:</dt>
      <dd class="col-sm-8"><%= @taxonomy.name %></dd>

      <dt class="col-sm-4">Slug:</dt>
      <dd class="col-sm-8"><code><%= @taxonomy.slug %></code></dd>

      <dt class="col-sm-4">Fixed:</dt>
      <dd class="col-sm-8">
        <% if @taxonomy.fixed? %>
          <span class="badge bg-success">Yes</span>
        <% else %>
          <span class="badge bg-secondary">No</span>
        <% end %>
      </dd>

      <dt class="col-sm-4">Story Taxonomy:</dt>
      <dd class="col-sm-8">
        <% if @taxonomy.is_story_taxonomy? %>
          <span class="badge bg-info">Yes</span>
        <% else %>
          <span class="badge bg-secondary">No</span>
        <% end %>
      </dd>

      <dt class="col-sm-4">Setting Taxonomy:</dt>
      <dd class="col-sm-8">
        <% if @taxonomy.is_setting_taxonomy? %>
          <span class="badge bg-info">Yes</span>
        <% else %>
          <span class="badge bg-secondary">No</span>
        <% end %>
      </dd>

      <dt class="col-sm-4">Created:</dt>
      <dd class="col-sm-8"><%= @taxonomy.created_at.strftime("%B %d, %Y") %></dd>
    </dl>

    <% if @taxonomy.description.present? %>
      <h6>Description:</h6>
      <p class="text-muted"><%= @taxonomy.description %></p>
    <% end %>
  </div>
</div>

<p class="space"></p>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h4 class="mb-0">
      <%= @taxonomy.name %> Taxons
    </h4>
  </div>
  <div class="btn-group" role="group">
    <%= link_to new_story_taxonomy_taxon_path(@story, @taxonomy), class: "btn btn-primary" do %>
      <i class="bi bi-plus-circle"></i> Add Taxon
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">Taxon Tree</h5>
    <div class="btn-group btn-group-sm" role="group">
      <button type="button" class="btn btn-outline-secondary" onclick="expandAll()">
        <i class="bi bi-arrows-expand"></i> Expand All
      </button>
      <button type="button" class="btn btn-outline-secondary" onclick="collapseAll()">
        <i class="bi bi-arrows-collapse"></i> Collapse All
      </button>
      <button type="button" class="btn btn-outline-primary" onclick="loadTaxonTree()">
        <i class="bi bi-arrow-clockwise"></i> Reload
      </button>
    </div>
  </div>
  <div class="card-body">
    <div id="taxon-tree-container">
      <!-- Taxon tree will be loaded here via JavaScript -->
      <div id="fallback-taxon-tree">
        <% if @taxonomy.taxons.roots.any? %>
          <div class="taxon-tree">
            <% @taxonomy.taxons.roots.includes(:children).each do |taxon| %>
              <%= render 'taxons/taxon_node', taxon: taxon %>
            <% end %>
          </div>
        <% else %>
          <p class="text-muted">No taxons found. Create the first taxon to get started.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%= javascript_importmap_tags %>
